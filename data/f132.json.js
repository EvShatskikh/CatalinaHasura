window.repositoryObject = {"parameters_custom_fields":[],"object_id":"f132","name":"atlas.after_insert_sm","subtype":"FUNCTION","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"Hasura","id":"d4"}},{"field":"Schema","value":"atlas"},{"field":"Name","value":"after_insert_sm"},{"field":"Type","value":"Function"}],"script":"CREATE OR REPLACE FUNCTION atlas.after_insert_sm()\r\n RETURNS trigger\r\n LANGUAGE plpgsql\r\nAS $function$\r\n     DECLARE photo_qt int;\r\nBEGIN\r\n     SELECT COUNT(id)\r\n     FROM atlas.sm_photo\r\n     WHERE sm_photo.sm_id = NEW.id\r\n          AND sm_photo.url IS NOT NULL \r\n    INTO photo_qt; \r\n\r\n     IF NEW.img_uploaded <> photo_qt THEN\r\n          UPDATE atlas.sm SET img_uploaded = photo_qt WHERE sm.id = NEW.id;\r\n     END IF;\r\n    RETURN NEW;\r\nEND;\r\n$function$","parameters":[{"name":"Returns","description":null,"mode":"OUT","data_type":"trigger","custom_fields":{}}],"dependencies":null,"imported_at":"2023-11-29 12:21"};