window.repositoryObject = {"parameters_custom_fields":[],"object_id":"f143","name":"hdb_catalog.notify_hasura_status-change_INSERT","subtype":"FUNCTION","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"Hasura","id":"d4"}},{"field":"Schema","value":"hdb_catalog"},{"field":"Name","value":"notify_hasura_status-change_INSERT"},{"field":"Type","value":"Function"}],"script":"CREATE OR REPLACE FUNCTION hdb_catalog.\"notify_hasura_status-change_INSERT\"()\r\n RETURNS trigger\r\n LANGUAGE plpgsql\r\nAS $function$\r\n  DECLARE\r\n    _old record;\r\n    _new record;\r\n    _data json;\r\n  BEGIN\r\n    IF TG_OP = 'UPDATE' THEN\r\n      _old := row((SELECT  \"e\"  FROM  (SELECT  OLD.\"updated_by\" , OLD.\"data\" , OLD.\"call_id\" , OLD.\"updated_at\" , OLD.\"status\" , OLD.\"operator\"        ) AS \"e\"      ) );\r\n      _new := row((SELECT  \"e\"  FROM  (SELECT  NEW.\"updated_by\" , NEW.\"data\" , NEW.\"call_id\" , NEW.\"updated_at\" , NEW.\"status\" , NEW.\"operator\"        ) AS \"e\"      ) );\r\n    ELSE\r\n    /* initialize _old and _new with dummy values for INSERT and UPDATE events*/\r\n      _old := row((select 1));\r\n      _new := row((select 1));\r\n    END IF;\r\n    _data := json_build_object(\r\n      'old', NULL,\r\n      'new', row_to_json((SELECT  \"e\"  FROM  (SELECT  NEW.\"updated_by\" , NEW.\"data\" , NEW.\"call_id\" , NEW.\"updated_at\" , NEW.\"status\" , NEW.\"operator\"        ) AS \"e\"      ) )\r\n    );\r\n    BEGIN\r\n    /* NOTE: formerly we used TG_TABLE_NAME in place of tableName here. However in the case of\r\n    partitioned tables this will give the name of the partitioned table and since we use the table name to\r\n    get the event trigger configuration from the schema, this fails because the event trigger is only created\r\n    on the original table.  */\r\n      IF (TG_OP <> 'UPDATE') OR (_old <> _new) THEN\r\n        PERFORM hdb_catalog.insert_event_log(CAST('public' AS text), CAST('operator_status' AS text), CAST('status-change' AS text), TG_OP, _data);\r\n      END IF;\r\n      EXCEPTION WHEN undefined_function THEN\r\n        IF (TG_OP <> 'UPDATE') OR (_old *<> _new) THEN\r\n          PERFORM hdb_catalog.insert_event_log(CAST('public' AS text), CAST('operator_status' AS text), CAST('status-change' AS text), TG_OP, _data);\r\n        END IF;\r\n    END;\r\n\r\n    RETURN NULL;\r\n  END;\r\n$function$","parameters":[{"name":"Returns","description":null,"mode":"OUT","data_type":"trigger","custom_fields":{}}],"dependencies":null,"imported_at":"2023-11-29 12:21"};