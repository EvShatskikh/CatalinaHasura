window.repositoryObject = {"parameters_custom_fields":[],"object_id":"f180","name":"public.get_acl_path_regexp","subtype":"FUNCTION","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"Hasura","id":"d4"}},{"field":"Schema","value":"public"},{"field":"Name","value":"get_acl_path_regexp"},{"field":"Type","value":"Function"}],"script":"CREATE OR REPLACE FUNCTION public.get_acl_path_regexp(hasura_session json)\r\n RETURNS text[]\r\n LANGUAGE plpgsql\r\n STABLE\r\nAS $function$\r\nDECLARE\r\n  _acl_path_regexp text[];\r\n  _user_org_structure uuid default null;\r\nBEGIN\r\n    select array(\r\n      SELECT os.path || '%' FROM user_acl ua\r\n      JOIN org_structure os ON os.id = ua.org_structure_id\r\n      WHERE ua.user_id = hasura_session->>'x-hasura-user-id'\r\n\r\n      UNION\r\n\r\n      SELECT os.path || '%' FROM public.user u\r\n      JOIN org_structure os ON os.id = u.org_structure_id\r\n      WHERE u.email = hasura_session->>'x-hasura-user-id'::text\r\n    ) INTO _acl_path_regexp;\r\n\r\n    IF array_length(_acl_path_regexp, 1) > 0  THEN\r\n      RETURN _acl_path_regexp;\r\n    ELSE\r\n      RETURN ARRAY['%']::TEXT[];\r\n    END IF;\r\nEND\r\n$function$","parameters":[{"name":"Returns","description":null,"mode":"OUT","data_type":"ARRAY","custom_fields":{}},{"name":"hasura_session","description":null,"mode":"IN","data_type":"json","custom_fields":{}}],"dependencies":{"uses":[],"used_by":[]},"imported_at":"2024-02-15 12:25"};