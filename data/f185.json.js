window.repositoryObject = {"parameters_custom_fields":[],"object_id":"f185","name":"public.get_issue_by_pk","subtype":"FUNCTION","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"Hasura","id":"d4"}},{"field":"Schema","value":"public"},{"field":"Name","value":"get_issue_by_pk"},{"field":"Type","value":"Function"}],"script":"CREATE OR REPLACE FUNCTION public.get_issue_by_pk(hasura_session json, _id integer DEFAULT NULL::integer)\r\n RETURNS SETOF issue\r\n LANGUAGE plpgsql\r\n STABLE\r\nAS $function$\r\nDECLARE\r\n  acl_users text[];\r\n  acl_groups text[];\r\n  user_id text;\r\nBEGIN\r\n    /* разрешенные исполнители */\r\n    select array(SELECT email FROM get_user(hasura_session)) INTO acl_users;\r\n    /* разрешенные группы */\r\n    select array(SELECT name FROM get_user_group(hasura_session)) INTO acl_groups;\r\n    /* залогиненый юзер */\r\n    user_id := (hasura_session->>'x-hasura-user-id')::text;\r\n\r\n    /* поиск по issue */\r\n    RETURN QUERY SELECT * FROM issue\r\n    WHERE id = _id AND is_active = true \r\n      AND (assigned_group_id = ANY (acl_groups)\r\n           OR assigned_user_id = ANY (acl_users)\r\n           OR participants @> array_to_json(ARRAY[user_id])::jsonb)\r\n    LIMIT 1;\r\nreturn;\r\nEND\r\n$function$","parameters":[{"name":"Returns","description":null,"mode":"OUT","data_type":"issue","custom_fields":{}},{"name":"hasura_session","description":null,"mode":"IN","data_type":"json","custom_fields":{}},{"name":"_id","description":null,"mode":"IN","data_type":"integer","custom_fields":{}}],"dependencies":{"uses":[],"used_by":[]},"imported_at":"2024-02-15 12:25"};