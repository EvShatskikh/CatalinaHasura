window.repositoryObject = {"parameters_custom_fields":[],"object_id":"f157","name":"public.after_issue_insert_set_sm_callback_user_id","subtype":"FUNCTION","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"Hasura","id":"d4"}},{"field":"Schema","value":"public"},{"field":"Name","value":"after_issue_insert_set_sm_callback_user_id"},{"field":"Type","value":"Function"}],"script":"CREATE OR REPLACE FUNCTION public.after_issue_insert_set_sm_callback_user_id()\r\n RETURNS trigger\r\n LANGUAGE plpgsql\r\nAS $function$\r\nbegin\r\n  /* проставляем user_id для sm из Atlas если они первее синхронизировались  */\r\n  IF new.origin IS NOT NULL AND new.origin LIKE 'visit_%' THEN\r\n    UPDATE \"atlas\".\"sm_callback\"\r\n    SET user_id = new.created_by\r\n    WHERE \"sm_callback\".\"visitId\" = new.origin\r\n      AND \"sm_callback\".\"user_id\" IS NULL;\r\n  END IF;\r\n  RETURN new;\r\nend\r\n$function$","parameters":[{"name":"Returns","description":null,"mode":"OUT","data_type":"trigger","custom_fields":{}}],"dependencies":{"uses":[],"used_by":[]},"imported_at":"2024-02-15 12:25"};