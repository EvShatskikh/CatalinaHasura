window.repositoryObject = {"parameters_custom_fields":[],"object_id":"f136","name":"equip.after_request_repair_update_add_request_repair_to_sync_smart_sw","subtype":"FUNCTION","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"Hasura","id":"d4"}},{"field":"Schema","value":"equip"},{"field":"Name","value":"after_request_repair_update_add_request_repair_to_sync_smart_sw"},{"field":"Type","value":"Function"}],"script":"CREATE OR REPLACE FUNCTION equip.after_request_repair_update_add_request_repair_to_sync_smart_sw()\r\n RETURNS trigger\r\n LANGUAGE plpgsql\r\nAS $function$\r\nDECLARE\r\n  sync_status text;\r\nbegin\r\n  /* після зміни полів request_status або status добавляєм запис для синхронізації в swe  */\r\n  IF (new.updated_by <> 'swe') \r\n    THEN sync_status := 'to-sync';\r\n    ELSE sync_status := 'synced_from_swe';\r\n  END IF;  \r\n\r\n  IF (new.request_status IS NOT NULL AND old.request_status IS NULL) OR\r\n    (new.request_status IS NOT NULL AND new.request_status <> old.request_status) THEN\r\n    INSERT INTO equip.sync_smart_swe\r\n      (\"table\", field, object_id, swe_id, value, updated_by_source, updated_at_source, sync_status)\r\n    VALUES (\r\n      'request_repair',\r\n      'request_status',\r\n      new.id,\r\n      new.swe_id,\r\n      new.request_status,\r\n      new.updated_by,\r\n      new.updated_at,\r\n      sync_status\r\n    );\r\n  END IF;\r\n  IF (new.status IS NOT NULL AND old.status IS NULL ) OR \r\n  (new.status IS NOT NULL AND new.status <> old.status)  THEN\r\n    INSERT INTO equip.sync_smart_swe\r\n      (\"table\", field, object_id, swe_id, value, updated_by_source, updated_at_source, sync_status)\r\n    VALUES (\r\n      'request_repair',\r\n      'status',\r\n      new.id,\r\n      new.swe_id,\r\n      new.status,\r\n      new.updated_by,\r\n      new.updated_at,\r\n      sync_status\r\n    );\r\n  END IF;\r\n\r\n  RETURN new;\r\nend\r\n$function$","parameters":[{"name":"Returns","description":null,"mode":"OUT","data_type":"trigger","custom_fields":{}}],"dependencies":null,"imported_at":"2023-11-29 12:21"};