window.repositoryObject = {"parameters_custom_fields":[],"object_id":"f137","name":"equip.before_request_repair_insert","subtype":"FUNCTION","is_user_defined":false,"description":null,"summary":[{"field":"Documentation","value":{"_type":"link","name":"Hasura","id":"d4"}},{"field":"Schema","value":"equip"},{"field":"Name","value":"before_request_repair_insert"},{"field":"Type","value":"Function"}],"script":"CREATE OR REPLACE FUNCTION equip.before_request_repair_insert()\r\n RETURNS trigger\r\n LANGUAGE plpgsql\r\nAS $function$\r\nDECLARE\r\n  _sw_id bigint DEFAULT null;\r\n  _cust_id integer DEFAULT 0;\r\nBEGIN\r\n    IF NEW.\"swe_id\" IS NULL THEN\r\n        -- sw_id 15 символів, перша цифра 9 - atlas, 3 - catalina, 4 - b2b\r\n        -- sw_id 7-й символ - 1\r\n        IF NEW.created_in = 'atlas' THEN _sw_id := 900000100000000;\r\n        ELSIF NEW.created_in = 'catalina' THEN _sw_id := 300000100000000;\r\n        ELSE _sw_id := 400000100000000;\r\n        END IF;\r\n        -- 2-5 символ cust_id (cust_id=21 --> '0021')\r\n        IF  NEW.\"cust_id\" IS NOT NULL THEN _cust_id :=  NEW.\"cust_id\"; END IF;\r\n        _sw_id := _sw_id + (_cust_id * 10000000000);\r\n        -- останні 8 симовлів номер п.п.\r\n        _sw_id := _sw_id + nextval('equip.request_repair_swe_id_seq');\r\n    NEW.\"swe_id\" = _sw_id;\r\n    END IF;\r\n  RETURN NEW;\r\nEND;\r\n$function$","parameters":[{"name":"Returns","description":null,"mode":"OUT","data_type":"trigger","custom_fields":{}}],"dependencies":{"uses":[],"used_by":[]},"imported_at":"2024-02-15 12:25"};